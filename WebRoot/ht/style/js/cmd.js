// JavaScript Document
$(function(){
	$("#west-nav").accordion({
		multiple:true
	});
	
	$("#tabs").tabs({
		fit:true,
		closable:true
	});
	
	$("#west-nav li a").click(function(){
		var tabTitle = $(this).text();
		var url = $(this).attr("href");
		addTab(tabTitle,url);
		$('#west-nav li div').removeClass("selected");
		$(this).parent().addClass("selected");
	}).hover(function(){
		$(this).parent().addClass("hover");
	},function(){
		$(this).parent().removeClass("hover");
	});
	
	$("#table-bumen").datagrid({
		columns:[[
			{
				field:'bumen',
				title:"部门名称",
				width:"10%"
			},
			{
				field:'shangjibumen',
				title:"上级部门名称",
				width:"10%"
			},
			{
				field:'shuoming',
				title:"职能说明",
				width:"73%"
			},
			{
				field:'caozuo',
				title:"相关操作",
				width:"8%"
			}
		]],
		rownumbers:true,
		singleSelect:true
	});
	
	$("#table-gangwei").datagrid({
		title:"岗位管理",
		columns:[[
			{
				field:'gangwei',
				title:"岗位名称",
				width:"10%"
			},
			{
				field:'shuoming',
				title:"职能说明",
				width:"78%"
			},
			{
				field:'caozuo',
				title:"相关操作",
				width:"13%"
				
			}
		]],
		rownumbers:true,
		singleSelect:true
	});
	
	$("#table-user").datagrid({
		title:"用户管理",
		columns:[[
			{
				field:'username',
				title:"登录名"
			},
			{
				field:'name',
				title:"姓名"
			},
			{
				field:'bumen',
				title:"所属部门"
			},
			{
				field:'gangwei',
				title:"岗位"
			},
			{
				field:'note',
				title:"备注"
			},
			{
				field:'caozuo',
				title:"相关操作"
			}
		]],
		rownumbers:true,
		singleSelect:true
	});
	
	$("#table-shenbaogenzong").datagrid({
		title:"",
		columns:[[
			{
				field:'date',
				title:"申请时间"
			},
			{
				field:'detail',
				title:"故障现象"
			},
			{
				field:'status',
				title:"状态"
			}
		]],
		rownumbers:true,
		singleSelect:true
	});
	
	$("#table-guzhangchuli").datagrid({
		title:"",
		columns:[[
			{
				field:'keshi',
				title:"科室",
				width:"6%"
			},
			{
				field:'name',
				title:"申请人",
				width:"6%"
			},
			{
				field:'type',
				title:"类型",
				width:"7%"
			},
			{
				field:'pinpai',
				title:"品牌",
				width:"6%"
			},
			{
				field:'model',
				title:"型号",
				width:"12%"
			},
			{
				field:'detail',
				title:"故障现象",
				width:"45%"
			},
			{
				field:'date',
				title:"申请时间",
				width:"15%"
			},
			{
				field:'caozuo',
				title:"操作",
				width:"4%"
			}
		]],
		rownumbers:true,
		singleSelect:true
	});
	
	$("#table-shenbaojilu").datagrid({
		title:"",
		width:"100%",
		columns:[[
			{
				field:'bumen',
				title:"科室",
				width:"10%"
			},
			{
				field:'shenqingname',
				title:"申请人",
				width:"8%"
			},
				{
				field:'shenqingdate',
				title:"申请时间",
				width:"12%"
			},
			{
				field:'detail',
				title:"故障现象",
				width:"43%"
			},
			{
				field:'banlidate',
				title:"办理时间",
				width:"10%"
			},

			{
				field:'banliname',
				title:"办理人",
				width:"8%"
			},
			{
				field:'status',
				title:"状态",
				width:"10%"
			}
		]],
		rownumbers:true,
		singleSelect:true
	});
	
	$("#table-yongcantongji").datagrid({
		title:"",
		columns:[[
			{
				field:'count',
				title:"用餐人数",
				width:"100%"
			}
		]]
	});
	
	$("#table-yongcanmingdan").datagrid({
		title:"",
		columns:[[
			{
				field:'name',
				title:"用餐人"
			},
			{
				field:'date',
				title:"用餐时间"
			}
		]],
		rownumbers:true,
		singleSelect:true
	});
	
	$("#table-yongcanjilu").datagrid({
		title:"",
		columns:[[
			{
				field:'date',
				title:"用餐日期"
			},
			{
				field:'status',
				title:"详细"
			}
		]],
		rownumbers:true,
		singleSelect:true
	});
	
	$("#table-wucanjilu").datagrid({
		title:"",
		columns:[[
			{
				field:'bumen',
				title:"部门"
			},
			{
				field:'name',
				title:"申请人"
			},
			{
				field:'date',
				title:"用餐时间"
			}
		]],
		rownumbers:true,
		singleSelect:true
	});
	
	$("#table-wancanjilu").datagrid({
		title:"",
		columns:[[
			{
				field:'bumen',
				title:"部门"
			},
			{
				field:'name',
				title:"申请人"
			},
			{
				field:'date',
				title:"用餐时间"
			}
		]],
		rownumbers:true,
		singleSelect:true
	});
	
	$("#table-shenqinggenzong").datagrid({
		title:"",
		columns:[[
			{
				field:'type',
				title:"领取类型"
			},
			{
				field:'count',
				title:"物品"
			},
			{
				field:'date',
				title:"申请日期"
			},
			{
				field:'status',
				title:"状态"
			}
		]]
	});
	
	$("#table-daibanshenqing").datagrid({
		title:"",
		columns:[[
			{
				field:'id'
			},
			{
				field:'name',
				title:"申请人"
			},
			{
				field:'bumen',
				title:"部门"
			},
			{
				field:'wupin',
				title:"物品"
			},
			{
				field:'date',
				title:"申请时间"
			},
			{
				field:'caozuo',
				title:"操作"
			}
		]]
	});
	
	$("#table-shenpijilu").datagrid({
		title:"",
		columns:[[
			{
				field:'id'
			},
			{
				field:'name',
				title:"申请人"
			},
			{
				field:'bumen',
				title:"部门"
			},
			{
				field:'wupin',
				title:"物品"
			},
			{
				field:'date',
				title:"申请时间"
			},
			{
				field:'status',
				title:"状态"
			}
		]]
	});
	
	$("#table-shenqingjilu").datagrid({
		title:"",
		columns:[[
			{
				field:'id'
			},
			{
				field:'wupin',
				title:"物品"
			},
			{
				field:'date',
				title:"申请时间"
			},
			{
				field:'status',
				title:"状态"
			}
		]]
	});
	
	$("#table-goodsjilu").datagrid({
		title:"",
		columns:[[
			{
				field:'person',
				title:"申请人",
				width:"10%"
			},
			{
				field:'date',
				title:"申请时间",
				width:"10%"
			},
			{
				field:'goods',
				title:"物品",
				width:"30%"
			},
			{
				field:'department',
				title:"部门",
				width:"10%"
			},
			{
				field:'donetime',
				title:"办理时间",
				width:"10%"
			},
			{
				field:'reason',
				title:"退回理由",
				width:"20%"
			},
			{
				field:'status',
				title:"状态",
				width:"10%"
			}
		]],
		rownumbers:true,
		singleSelect:true
	});
	
	$("#table-shenqingchaxun").datagrid({
		title:"",
		columns:[[
			{
				field:'date',
				title:"申请日期"
			},
			{
				field:'mudidi',
				title:"目的地"
			},
			{
				field:'count',
				title:"人数"
			},
			{
				field:'yongchedate',
				title:"用车日期"
			},
			{
				field:'status',
				title:"状态"
			}
		]]
	});
	
	$("#table-daipishenqing").datagrid({
		title:"",
		columns:[[
			{
				field:'date',
				title:"申请日期"
			},
			{
				field:'name',
				title:"申请人"
			},
			{
				field:'bumen',
				title:"部门"
			},
			{
				field:'mudidi',
				title:"目的地"
			},
			{
				field:'count',
				title:"人数"
			},
			{
				field:'yongchedate',
				title:"用车日期"
			},
			{
				field:'status',
				title:"状态"
			}
		]]
	});
	$("#table-daibanshenqing-geren").datagrid({
		title:"",
		columns:[[
			{
				field:'date',
				title:"申请日期",
				width:"15%"
			},
			{
				field:'name',
				title:"申请人",
				width:"10%"
			},
			{
				field:'bumen',
				title:"部门",
				width:"10%"
			},
			{
				field:'mudidi',
				title:"物品",
				width:"40%"
			},
			{
				field:'done',
				title:"办理时间",
				width:"15%"
			},
			{
				field:'status',
				title:"状态",
				width:"10%"
			}
		]],
		rownumbers:true,
		singleSelect:true
	});
	
	$("#table-cheliangspjl").datagrid({
		title:"",
		columns:[[
			{
				field:'id'
			},
			{
				field:'date',
				title:"申请日期"
			},
			{
				field:'name',
				title:"申请人"
			},
			{
				field:'bumen',
				title:"部门"
			},
			{
				field:'mudidi',
				title:"目的地"
			},
			{
				field:'count',
				title:"人数"
			},
			{
				field:'siji',
				title:"司机"
			},
			{
				field:'tel',
				title:"联系电话"
			},
			{
				field:'yongchedate',
				title:"用车日期"
			},
			{
				field:'status',
				title:"状态"
			}
		]]
	});
	
	$("#table-cheliangsqjl").datagrid({
		title:"",
		columns:[[
			{
				field:'id'
			},
			{
				field:'date',
				title:"申请日期"
			},
			{
				field:'mudidi',
				title:"惠阳"
			},
			{
				field:'bumen',
				title:"部门"
			},
			{
				field:'count',
				title:"人数"
			},
			{
				field:'siji',
				title:"司机"
			},
			{
				field:'chepai',
				title:"粤L 88888"
			},
			{
				field:'tel',
				title:"联系电话"
			},
			{
				field:'yongchedate',
				title:"用车日期"
			},
			{
				field:'status',
				title:"状态"
			}
		]]
	});
	
	$("#yongcheshenqing-panel").panel({
		title:"用车申请"
	});
	
	$("#chaoshi").panel({
		title:"用车申请"	
	});
	

	$("#table-yongcheshenpi-lingdao").datagrid({
		title:"",
		columns:[[
		{
				field:'name',
				title:"申请人"
			},
			{
				field:'shenqingdate',
				title:"申请日期"
			},
			
			{
				field:'bumen',
				title:"部门"
			},
			{
				field:'qizhididian',
				title:"起止地点"
			},
			{
				field:'count',
				title:"人数"
			},
			{
				field:'shiyou',
				title:"事由"
			},
			{
				field:'yongchedate',
				title:"用车时间"
			},
			{
				field:'cheliangxinxi',
				title:"车辆信息"
			},
			{
				field:'lingdaoshenpishijian',
				title:"审批时间"
			},
			{
				field:'status',
				title:"状态"
			}
		]],
		rownumbers:true,
		singleSelect:true
	});


	$("#table-yongcheshenpi-paicheyuan").datagrid({
		title:"",
		columns:[[
			{
				field:'name',
				title:"申请人",
				width:"6%"
			},
				{
				field:'shenqingdate',
				title:"申请日期",
				width:"10%"
				
			},
			
			{
				field:'bumen',
				title:"部门",
				width:"6%"
			},
			{
				field:'qizhididian',
				title:"起止地点",
				width:"20%"
			},
			{
				field:'count',
				title:"人数",
				width:"4%"
			},
			{
				field:'shiyou',
				title:"事由",
				width:"25%"
			},
			{
				field:'yongchedate',
				title:"用车时间",
				width:"10%"
			},
			{
				field:'status',
				title:"状态",
				width:"10%"
			},
			{
				field:'chepai',
				title:"车辆信息",
				width:"10%"
			}
			
		]],
		rownumbers:true,
		singleSelect:true,
		autoRowHeight:false
	});



	$("#table-yongchedaiban-lingdao").datagrid({
		title:"",
		columns:[[
			{
				field:'shenqingdate',
				title:"申请日期",
				width:"8%"
			},
			{
				field:'name',
				title:"申请人",
				width:"5%"
			},
			{
				field:'bumen',
				title:"部门",
				width:"8%"
			},
			{
				field:'qizhididian',
				title:"起止地点",
				width:"17%"
			},
			{
				field:'count',
				title:"人数",
				width:"5%"
			},
			{
				field:'shiyou',
				title:"事由",
				width:"28%"
			},
			{
				field:'yongchedate',
				title:"用车时间",
				width:"20%"
			},
			{
				field:'status',
				title:"状态",
				width:"5%"
			},
			{
				field:'caozuo',
				title:"相关操作",
				width:"5%"
			}
		]],
		rownumbers:true,
		singleSelect:true
	});


	$("#table-yongchedaiban-paicheyuan").datagrid({
		title:"",
		columns:[[
			{
				field:'shenqingdate',
				title:"申请日期"
			},
			{
				field:'name',
				title:"申请人"
			},
			{
				field:'bumen',
				title:"部门"
			},
			{
				field:'qizhididian',
				title:"起止地点"
			},
			{
				field:'count',
				title:"人数"
			},
			{
				field:'shiyou',
				title:"事由"
			},
			{
				field:'yongchedate',
				title:"用车时间"
			},
			{
				field:'caozuo',
				title:"操作"
			}
		]]
	});

	$("#table-yongchejilu").datagrid({
		title:"",
		columns:[[
			{
				field:'person',
				title:"申请人",
				width:"5%"
			},
			{
				field:'shenqingdate',
				title:"申请时间",
				width:"8%"
			},
			
			{
				field:'didian',
				title:"地点",
				width:"10%"
			},
			{
				field:'renshu',
				title:"人数",
				width:"3%"
			},
			{
				field:'shiyou',
				title:"事由",
				width:"15%"
			},
			{
				field:'usecartime',
				title:"用车时间",
				width:"15%"
			},
			{
				field:'cheliangxinxi',
				title:"车辆信息",
				width:"32%"
			},
			{
				field:'lingdaoshenpishijian',
				title:"领导审批时间",
				width:"8%"
			},
			{
				field:'status',
				title:"派车员审批",
				width:"5%"
			}
		]],
		rownumbers:true,
		singleSelect:true
	});
	
	$("#table-shebeixinxi").datagrid({
		title:"",
		columns:[[
			{
				field:'type',
				title:"类型",
				width:"10%"
			},
			{
				field:'pinpai',
				title:"品牌",
				width:"10%"
			},
			{
				field:'xinghao',
				title:"型号",
				width:"10%"
			},
			{
				field:'canshu',
				title:"参数",
				width:"31%"
			},
			{
				field:'weizhi',
				title:"位置",
				width:"10%"
			},
			{
				field:'name',
				title:"负责人",
				width:"8%"
			},
			{
				field:'date',
				title:"采购时间",
				width:"12%"
			},
			{
				field:'caozuo',
				title:"相关操作",
				width:"10%"
			}
		]],
		rownumbers:true,
		singleSelect:true
	});
	
	$("#table-shebeixinxi-geren").datagrid({
		title:"",
		columns:[[
			{
				field:'type',
				title:"类型"
			},
			{
				field:'pinpai',
				title:"品牌"
			},
			{
				field:'xinghao',
				title:"型号"
			},
			{
				field:'canshu',
				title:"参数"
			},
			{
				field:'name',
				title:"负责人"
			},
			{
				field:'date',
				title:"采购时间"
			}
		]],
		rownumbers:true,
		singleSelect:true
	});
	
	$("#table-shenpijilu-geren").datagrid({
		columns:[[
			{
				field:'shenqingname',
				title:"申请人"
			},
			{
				field:'shenqingdate',
				title:"申请时间"
			},
			{
				field:'shenqingwupin',
				title:"物品"
			},
			{
				field:'banlidate',
				title:"办理时间"
			},
			{
				field:'tuihui',
				title:"退回原因"
			},
			{
				field:'status',
				title:"状态"
			},
			{
				field:'banliren',
				title:"办理人"
			}
		]],
		rownumbers:true,
		singleSelect:true
	});
	
	$("#table-cheliangxinxi").datagrid({
		columns:[[
			{
				field:'pinpai',
				title:"品牌"
			},
			{
				field:'zuowei',
				title:"座位"
			},
			{
				field:'chepai',
				title:"车牌号"
			},
			{
				field:'buydate',
				title:"购买时间"
			},
			{
				field:'caozuo',
				title:"相关操作"
			}
		]],
		rownumbers:true,
		singleSelect:true
	});

	
	$("#guzhangshenbao-panel").panel({
		title:"故障申报"
	});
	
	$("#add-bumen-panel").panel({
		title:"部门添加"
	});
	
	$("#add-gangwei-panel").panel({
		title:"岗位添加"
	});
	
	$("#add-user-panel").panel({
		title:"用户添加"
	});
	
	$("#woyaodingcan-zaocan").panel({
		title:"午餐"
	});
	
	$("#woyaodingcan-wancan").panel({
		title:"晚餐"
	});
	
	$("#wupinshenqing-panel").panel({
		title:"物品申请"	
	});
	
	$("#yongcheshenqing-panel").panel({
		title:"用车申请"	
	});
	
	$("#chaoshi").panel({
		title:"用车申请"
	});
	
	$("#wupinshenpi-panel").panel({
		title:"物品审批"
	});
	
	$("#add-cheliang-panel").panel({
		title:"车辆添加"
	});

	$("#edit-cheliang-panel").panel({
		title:"车辆修改"
	});
	
	
	$("#bumen-select").combobox({
			editable:false
	});
	
	tabCloseEven();
	
});

function addTab(subtitle,url){
	if(!$('#tabs').tabs('exists',subtitle)){
		$('#tabs').tabs('add',{
			title:subtitle,
			content:createFrame(url),
			closable:true,
			width:$('#mainPanle').width()-10,
			height:$('#mainPanle').height()-26
		});
	}else{
		$('#tabs').tabs('select',subtitle);
	}
	tabClose();
}

function createFrame(url)
{
	var s = '<iframe name="mainFrame" scrolling="auto" frameborder="0"  src="'+url+'" style="width:100%;height:100%;"></iframe>';
	return s;
}

function tabClose()
{
	/*双击关闭TAB选项卡*/
	$(".tabs-inner").dblclick(function(){
		var subtitle = $(this).children("span").text();
		$('#tabs').tabs('close',subtitle);
	})

	$(".tabs-inner").bind('contextmenu',function(e){
		$('#mm').menu('show', {
			left: e.pageX,
			top: e.pageY
		});
		
		var subtitle =$(this).children("span").text();
		$('#mm').data("currtab",subtitle);
		
		return false;
	});
}
//绑定右键菜单事件
function tabCloseEven()
{
	//关闭当前
	$('#mm-tabclose').click(function(){
		var currtab_title = $('#mm').data("currtab");
		$('#tabs').tabs('close',currtab_title);
	})
	//全部关闭
	$('#mm-tabcloseall').click(function(){
		$('.tabs-inner span').each(function(i,n){
			var t = $(n).text();
			$('#tabs').tabs('close',t);
		});	
	});
	//关闭除当前之外的TAB
	$('#mm-tabcloseother').click(function(){
		var currtab_title = $('#mm').data("currtab");
		$('.tabs-inner span').each(function(i,n){
			var t = $(n).text();
			if(t!=currtab_title)
				$('#tabs').tabs('close',t);
		});	
	});
	//关闭当前右侧的TAB
	$('#mm-tabcloseright').click(function(){
		var nextall = $('.tabs-selected').nextAll();
		if(nextall.length==0){
			//msgShow('系统提示','后边没有啦~~','error');
			alert('后边没有啦~~');
			return false;
		}
		nextall.each(function(i,n){
			var t=$('a:eq(0) span',$(n)).text();
			$('#tabs').tabs('close',t);
		});
		return false;
	});
	//关闭当前左侧的TAB
	$('#mm-tabcloseleft').click(function(){
		var prevall = $('.tabs-selected').prevAll();
		if(prevall.length==0){
			alert('到头了，前边没有啦~~');
			return false;
		}
		prevall.each(function(i,n){
			var t=$('a:eq(0) span',$(n)).text();
			$('#tabs').tabs('close',t);
		});
		return false;
	});

	//退出
	$("#mm-exit").click(function(){
		$('#mm').menu('hide');
	})
}
